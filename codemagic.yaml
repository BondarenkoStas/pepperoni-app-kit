workflows:
  react-native-workflow:
    name: react native workflow
    environment:
      vars:
        CM_KEYSTORE: Encrypted(Z0FBQUFBQmQyX2ZXVE15WUhvcHBVLXBiWU52MWVNakNVMUp5U2xtdE1aeXk4bVNvV3JobUM3RTItSEIyT0loTlVqNWU3ZEVXMTdaSWhab0c5YlZZYnJGOFdIWGd1NF8taFBMZHFsT0JmdnVpdFNHYy1UenV0WFNYLThaZkRpOUl4c2JiQnJZWHBSVVkwajkyQVdZc2RrUC1OSGFzU2pyNjdyd19QdzJvNlQydW5uVkV2cm9wRzdsY3YwYnJBRHVPWkZnTWZkUDJTOU9YZTFCeFdIZ25vMlk4YkFYSzl6YWtvNThBakZMVmgxT2FhTWlpcS1fU1FGOGh0TU5EV2ItOVV4XzAyQ1lBdUdnYzBfamlvMjdFM3g5blF2cThfZmVHSF84WE1Qd0VXRlA1b29QbmUwZG5ZbTZmVUhxR2x5TS1DTzBoalZCV0ZqYlEtLUtvTW0tZDctY2RjamtDVnYwZVJNOENiR1FheU96cXpfbzBZZWNGcy1yVGdMWlJFNUFoRXFRSFVmTUNwQ2trdnhTbG5RemFnTkR6V19RYURmY0VPV0RNemFad1B0N3NkRlJqNFdFUjJYZjk0cHhEYzRPMmlWRnpnb2MtRURQT3lqeXk0WkM3eFlvRkJQQU1ucHpGS3VpV3JnTTQ0ajRFNERRUUZmeko0eHZINFg2MlBCd0xZTGRmejhINjgzeWFtbGNDcVRVRk1HZHVXY1VqLWNvN3d4bG91ZW1wcU1lTTFzLWk2OURWZklDa3NXRWtlYjNGeW5jeUdPZGFnLTBOSUNDNndkZXZpdDJOX3c4VG83b3pMYURYWUlhcFNtM2E1YURsYzc2QjB6Q0NIM2NxVDRPMG45VjRMcWp4TlZ1eG13RGl4RXFmNHIyTjhMUjA3b0lwX3Q4aUx5Ym8tNWtTQzdMM2ZUVVBlVmVGMHZUemtIT0lueG9WSFRKdDY4dkRJVnF0UXJMOUFrVUswYUNhNGJiUWFaMVFfTXlnRk9TWC1zd3FPQWJhN1BGRnQ3b0FtQTlVQlBZV1hjcVlYaHcwSm01OUxtWVZTWWRLVDhCZ3hzeTJqXy1nQWJwR0VhYWUxSlIwdnZmeGd5elZoMm5KSlE5QUxHUjFOQjhuZVBVQlFlc3J0SFVmUzZQcXhHTjJ6MFhSQklkek5Mc1JJa0ZiSjgtTU5ldGxmWUxrOTB2cDQtYXRZcTBNMExjS3pHVUR0SGxJSlQwYTMwX1dySWNvSjVfUEpXYmJRc1VxZ3ZxNzZVQTRTeXE3TmQ0WjlyNXRXcC1NNmJPdk5POUZiODdMZ1JOSHNCalUzbGROVEw4RDZPMDJ6d1BsRE5HRzVXNlhsdVlGY3RfWUFwR2xoTnBqa01IRTRWWmozOHNVajF5aHdkdGFJeTBIQzhiUGNXMFNzcy05eFB6UnpLNWcwNnlST2JCZjN2Rnhzd3B3SlRHS3E4eXB2Rko4eDZ4bEczSWxpZU9keDBrTkxBV0FvUlVMMVJnekNsbTFLWlIyeWUzM0IwSzdLTmdEN2ZOTEF1ZVcxWGlvZHk3U1BzdGxTUFBZSkx3c2RzZ3gyX2pkX2JHT01CUUY3emxTWS11V3lmaG1JZlRuV25aVmZUVU1MS293Qy1JNzFxclk3SlBWNmJoMWRxWGRFcko4WldRQ2JOeU5XX01nMXcxQ2xxV2NPeUxVcXJtR2RHSzd6NFk5bkhyMU9XWEFOWTgtdS1HV1puWUEzb0VBb0Y5WldINHZWVlA0QXNSelRFWmJjeUh4cWZOZURUT0ZLeGRQRnR5aldramdkN3M0UXVpeVB2MXdNcWZqUjdKRTZsakFHZWRaT1RTVGFPZjlXYmdDb21HalhUZ21TRVhCVV9ZQ1ZaM1ZpOE5HUFlWUzJOVEU4QTFsaXh4bjNWMDUtZmNyY3lEbFRsRmtFTnBqSHlwUk9OMDRvcUxWXzByQUctaTEzTlJvSUN3NHBKNnZXU2J4Z1RXSVpGWGs2UlVwOUpud3hlWDd0cllSYTdfcVI2RjBtMlZ1WmJPYjhOeENfMzNxVnRrTDZJMVMzM2RYNHVrcG5uS0dBbXFtcmVDc3BCS3k0dGlBYVkwMUtlZ1UyanJPRDFuUHF2VXhLM0Y5V01pOHB3Rm9jTXlKaWZqY08zeUVrcEVTbkdXU01qUVNiZUY1YzVoMjJoM3Zqem5ybXpDOWF0c3JSQk9GaFJHT0RvS0MzUWg1YUY4N3k1emlYYnpfVUttYWt0MGRpbWprLVhJWi14Zi15TGVtMnQxTlEyVmNDdU4tOVlHbldQa1FmZXhRelBUV0ZycEs4Sm44dkd3OWdfN09vNXdyQVZWc0lHakNmV0w3SmRIaWlEUk1SQm9QczlMTy1LUXFlZllGMTlTT0NrQjg1LV9OcXA1MDhjMmN4WGRBc2otUkFucVNGN21QN1VwRDdrblctLXhzT0FtTlh1aUYyVnBpOGtxNUQ0Z2xCemdBd2N6Y28zZUE2TmhldzdzUmVWRWdpSkVYbmNkN3BzRHg5ZDQzLUlxOHlUMmNkbmZmRXRuZjBuaVdOUEVvdmxZanV2dE9NdFRVWG12a3JmY3UtVzJ0dHRjdzFnNHljSlRVdTVjRVJtQUxlN2VSQ0pmZkZZQ0FfNHFpcFhleTJyQVZsWHJTMFNVazFJeTRYVUFEeE80VkEtREpROVYxQmJHeUtETXFGV2hfTXBmMkxNbmg1cmt1NDBsZUtyMDZLMnJIbWhYZ3dKSnpfREVUX29RYWpOb2pvU3Yzc2F4NVotZHpqRm16YkxDZmJySi1oVTB6R1VEOFlDZGFtTnZ3dmY3dUpnSTk4czJCcmhGdzIxcmNOV0VLMl9idGFoQWhqRkhONnZJVEplbC1CSVBGMkVBekVpNklMbFpmUFI0T3gzVm8xYVowSk12WFlNMk1TZFd5YXVmRjZIVE40SEt3aC1iak9UMnk1TUl2WG11ekQ3SHRyYW9weUdsY2FrNUoyZncwOElIckpJREFtS1dydDhEX2dyMkhJSXA1a1FraEZKRUlSNkU0Vk9DaXduTEwtdDV5eWlXR09aRGQ2X0ZDTTNiVFA4SGtDcUtSTWdYa1paNFJRQjM1V3N4N2VvMjRKXzltOXZ6d1JFamRNUWRaY2RkV2h0eTJHRUNnREJqNFUxbTBvbnNUUnhnUC1vX0FEZV9NWmNEQkJ2UWxVVEZDcmdjZFNzQXBzMHV0U1FRUDlFMWplbmNTd0U4Xy1ueFpPN0dOV1hiMG1PbE5tTjhESm5fUEJGVWxvbWNQVjRyWDFUenpRRFFwWlJhdkJrY3dHcHVaanZucTdFZzA1dnZ4YUZTZV9aU2NCRk5kMVUyaFJfeVF6T0pmdWhzQnM0ZGppVFJXV1dCRko3Uzd5RlJEbG4tbk1lVmVFVW5jSjF1R1ZIUVd3VXg0YVpKdXFha205V3gtNnlkYzVGYWRmeWxaOG92UmYtc1BVNl9YX25mbk1yTHQ0Wk5NN2tVaXRtZ3pJR1JyQXNsRUp4STBPcHdmMWFySll6MmRDekp0YlpWbUsxV1RmcE1lNkExU3lfZzlYa0FGVnZxZzBkSE95VnZlOGR1WjN1YmF0SHQ5Q3hibUpqd0pDX2REM3h2NGhnU2RsNXloUlJQNURUYmdJQVNKOFJISzZuempFbE9qZF9tcGFZb0ozM3NvZUt1ZElrNzR3RFFtNkk5ZWFMd3dlZnBXemE2SDFqeVlXR3doM21yTzFfcEV3UnowNUI2bzV3WGVmT1hLcE1nR0IteEpFcmpzTExkOUxBTWM2bUZMeE1XUkxucVZEbFg0RDdENFdhdm5tOFdNRk56MnVRc1dQV0ZFVktTajlCYVNtMXUwMy1KUXZzanVDWlhJMzF0VmQyekZjclR0eHphWEthb2pqaEJObUJsbHk3RnB4N3dra1FEVU8tYU9Cd1F4TUw3V094VmZRS3F4MEktNkpidUxNY0FWMmhLc3ExU083YTU4cXJBTGtZYmRtSEYwZVJHQmdEdktNaEpuR1NyOTFZMkp2U0lweEJlTVpRZWJia0RBci0wLWotZHo1Y0t6UWg4ekR1R3BYTG5VdWJDaTd2TkZaYkdvM0lJczJWcDFVd2VDTlJUX0ZsSUhlNkxxc0xnSkNDLUo0SXl5M0xUdzNyN1JQb1ZLNU1zbnpqVzM5MmptaDhTcTZJdEVyaWJGYlFHZFZ3eFlqaFpUN1otcG93LUV6X0dKU3VObnlMLUNQbGZRQl9BOUZfT0oxdmlBbDJ2M25YeVQxeGdTY0pZdTIyeTNqZHFUVHAteGk0aXRHNDhxU0dNNWRQc3JGRWhqbVlfMkhTVmx4Z0pBdWRqbHg5bEpJRzVTRTd0a3ZQTkhiaUlvOG5odERZT0hCV19GenZsUWdCamxhbUxyWG43aGxPekx0T3NqMHhTRlFkQ1lIUnhKLXM3dGRDb2RCTkNfT252bktmTzhSNjJBWkJoMlQyOUQwQzA5SE5FYWhSUXozdnVuTE9CNkNzQ0pfeDR2ZGFNWXpuc0lKWUJsc3hSR2R5U0NFVnRyNmQ1N1pFRHZZYVRuMXVmZ2RKWV91NlFnTXpHY2pkYk9lcEJjTVVpQUJaTG1MVjNtUEcwclltLTZPMXJ0aFBkSENqd0VqWmtNSkpyMkZkRHpnMDJhNVRBODQ0cG1ra0hVbWMzbGlrclgyN1UyN0dJM1ppeEhtNTBaZ0dpcnZQUVd2Qm5xb3pRSXdWN3hOZWFSZ1FlRE82ckFLUmxSM1VQU284QlJTWmFRUWVFXzlzOFdJZjdOMUtJTmhqcHRadEhUNTdXeEpmN2JMd0RFTE8wekp5TTF1TFB3SDYxMUtyeHVLcGlPdmU4TWFCbGJkckJlVHZITjdxcHZtbDZxN2UxSmtCak5XbmFIV1EwRlpFaW0xTU03T001S1gxR240R1JnSk9GUmlleGNubzlSaHJGZjRWSjVfcF9Ld01EY2wya1RhTV9kY25IbXBQQncteU5PVUpNV2ZwcFE0OEpDMHVFRjVCcWVmTGFUcTZ4OFV6dnFCT2JDdWZFWlNiT3B6M19DRHptWHlGRG1oRVNUeWMtVml3SF9sRmhvMGttNEM0bTh0SVJwU2x1a2pZOTBPZXRDUDhTUDNVbTA2M2FLUHdxaDB6U2kzM1BnbTF6a0hiVTAwa0ViQUhiNjdqdGlhNl9kc3o4a2x0ZkhHczQ2Q0lEZjU2MTJBWVMzVmc4dDRKWWc4UHk4cnFDMkh0YWFsNmVQU3pXaU1pYzE2WGd5ZEhRV1k5cm01eVVKTjJCVzFKQVdHblBsVGFUdUNDSlR2VHBibDlwX3hsZFRMQm1jekZOc09vZER4Y3hxbVlLSnJoR0tNUkNrc3otbjM2cFN1WFMwSWlQejE3TzZrWjMyMVliaTFQekdkcU9tNDJmTGxCLVZRRHJpeHJSYjZUbFVrbXB6VW9OVENxQVNJbEN5dkZSbmpGST0=)
        CM_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmQyX2hla1h3MWFmTjFjb3VLaFhKR2luV2NKZUxiT0FOVHpNWjktNURmaktFTldHOGlzdGVuUWVqY2Y0dmpvLUw4WjB6eEJMMXpkSGw0ek9reVZySkVDZ2hpcnc9PQ==)
        CM_KEY_PASSWORD: Encrypted(Z0FBQUFBQmQyX2hla1h3MWFmTjFjb3VLaFhKR2luV2NKZUxiT0FOVHpNWjktNURmaktFTldHOGlzdGVuUWVqY2Y0dmpvLUw4WjB6eEJMMXpkSGw0ek9reVZySkVDZ2hpcnc9PQ==)
        CM_KEY_ALIAS: Encrypted(Z0FBQUFBQmQyX2djZFAyenVxWS1CM25QZ01KTllNbHRaaXFfbktKMmdzM1hGTjZwejBGb0tveHZPY19NdjRHV1EzT3JXUzU0UFFLNXVEQzFLbkVXU2lnQy1hVkNHazl6LVE9PQ==)
    triggering:
      events:
        - push
    scripts:
      - |
        rm -rf ~/codemagic-build-scripts
        git clone https://github.com/NevercodeHQ/codemagic-build-scripts.git ~/codemagic-build-scripts/ --depth 1
      - echo $CM_KEYSTORE | base64 --decode > acuity.jks
      - npm install
      - |
        cd android
        ./gradlew bundleRelease
      - |
        ~/codemagic-build-scripts/android/generate-universal-apks \
          --ks $FCI_BUILD_DIR/acuity.jks \
          --ks-pass $CM_KEYSTORE_PASSWORD \
          --ks-key-alias $CM_KEY_ALIAS \
          --key-pass $CM_KEY_PASSWORD \
          --pattern 'android/app/build/outputs/bundle/release/app.aab'
    artifacts:
      - android/app/build/**/outputs/**/*.apk
      - android/app/build/**/outputs/**/*.aab
      - android/app/build/**/outputs/**/mapping.txt
