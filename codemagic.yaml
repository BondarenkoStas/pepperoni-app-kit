workflows:
  react-native-workflow:
    name: react native workflow
    environment:
      vars:
        CM_KEYSTORE: Encrypted(Z0FBQUFBQmR5dFZNTEJWQzlkQWcteEdkbGJ5UTdSLWhlaFR6NmNyZXpMQ0Y2OGNpQzNwb0Y1TU4wTk4wLVkxT0VWTXI0cEZxUE9Md3FDU2VWcGJlS2FzQjB5WlVfRTlkdHFZVVVzQWMyc1RTNGRzRVg3Njl0aEFPWm9UQmhrb2t4OUNsVWVyNFJEczVHQjcxbklXUFZfRG91U1JQYl9TbDBNQkY2ckVFMXV5cUVQTko2TjhNYlo4OEZlSzB5Z2FWTTkyYXZXZHRtcEVTSW5RR2VuYkN1c3B2ZEdPRURaZ29TbG1PU2dzV3IxWFJYc20ybHlickMxYU1sYVlzVWpDS3RlU3g4NGY5MDdwUDV3T3Q3cUswSzJ5RnJFRngyejBQalBuM3lTQjcxdUNpMmtUUWVtek9jLWI2R1RRY0xlSEhwb2JuNHdQVjNmaHFuMXlOTWlnM3l6VldMblJkYjFhWXI1SXJTd0ZiZFF4TUJVOTVQYWhRbTZMNWtrNWdNbTlkbHpidl9tZTdCWXJTdjRfMTRPN1JyLUlvVGw1NVpjeDA1WnU5Z0lmSmFlaklDVUVyNXNQSllBZ3VGc3lKSFVSblhrXzVGQVpNMVNTSFBsQjJSYWxZR0QzaVpYNDR3ZGJlVW1JM3RWc1FvT3JvMnJrYW9VMUJUaU1QdXZaRlZQb0NjY2FobVMwd1ZaYlJ4RldQMi0xRnY4V25BNnNZMUVDSlZyZEhSRTlSeF9qNl9mRHNNWkMwYzJETm5DeXRIcnBZa1phWWNjMXQxNmpwLXdMOGkxZG9lZGhyT29LT3E2d1JhRk1IM2MzbEhERzZFYzE0TG1XZDhuTi1nRjBOOHVsbExZTXhqc1YyN1RWUEJiVkFLeWUyTXJ3ZnlFcXRFOFRHdlBLX0QwVkhEcXhhRXJnMDZvSnZsNlYwMzExa3kzSjZkQU5ONjdUTnZhV3BoanBHZnJBN2NQOW8wLTY5RF80RjIxeEJrekdYUm1nN3FKMkhPSWUwTEY0YVpnUmVpM1ZXcHNyMEZTeU1yZ3VBMHo2UEl0dFBZQWZRR0F1Z1BaNG5icjI3RzJtMjlRZ0k3YlVGZC16aHJEaU9ra09KcjhzNWdic0RKRkFvb3gxd3pIRjlHaE5OQnUyb2k4S1NTZjlNVHVIQ1N1V3hCbEV4RGY3VTFXVHQzUzlITFV3S3VXbVhyTmRrVVV0aERINzJfMEQ2bEEwNE14c0JEZjNmV3czMXl1MDNXdk5rZjQwYm9JdW5LN2VSYm9jUkhvcTRPXzg4TEpmdDVnRThwcDd0bDFBZFFOS1JKeWlyMExTMG15Q0NzMndHSnF4ZEZvVzRWOFJuR1JLVTM0RUpfdXlJbTlPd1NzNU9NX0hrbndxZkd0SFQwWndEbzFfNTdQZ3pIWHVLMkpzaHduLUJMc1JKb3FtUEJTZm1lWXVjLVpFZXRIdHRsNUxOMXJtYV9JZlhld29zZS14YmdGbEZyNDBCNWRScW9QSG05SXYzbEJjUzVtY3BYbVhwLWFjZVpQWVpYRlEweTBrTXplbXB2OGVHTjVYODhheDRfZWU1ZXVlU0dPTEpQLXhIUFhYNEdnSDFDeEZqQzZqYndIY252allMcVp6eGIxdGxteVNxWERGYkNzS2dNR1VuajNpVDM2YVEzaXpNc2k5WkVPOWJzQmEwU0ZIOUJfTFZQaWVBa3hEMmwyXzFVMEdrcm81SlM2ckZIUWJ0ZXFVSDVwVlk5WTdKLWcxcEJjWHJIWU9POTR1MGFlUjFoMHQ2V01QWEN4Y21UNmNoX0Y4dk1DMWZNZEdmR3EtbHY0anB6WExtVGpnb3hxUnRKMTF4S0xWcnNiZVFxTjBWSDJEUlB6c2E2YzdXR0R3Qzk2OEZFWFBkOGJFTHJGZzRua1NoRjJ4VlJEaWVDRHVidk1uWGFZQ0tndmxDb0pfY3o1XzBKQUhKSDgwelU0X3pnQmN2N2QtYkMxcURNZUtJSk5ldmxQclk1SW9yNDk2Z3gxV3VYTHB6MkFjTU9JOWo1amNqSW1JaGQ5ZW9kMjZUUGtGZHpsQ2ZKbDBQRVJlcmRyU2xMM21Gcl9rdGhhdnlLMHZKQzB4aFNsOFhnbWpaNXdQS2p6OFo4WmxtSG5sV2RzdHk5MVlsbkJKT1dYX2dyYVUxQmctZmlYWm9sanhnQVdQcjc4SEZKQ2pCejROWWpMTVVNWUdhbFVfaFhOeFJhb2FMTkVyaUphZ0FMc2EwUENQOFU1NU9PdGJPMjBEd0NHLWhLUzZqYlM0UUoxUWtueGdJT2trYnhmOFdzUXVfOGNnejctcjZkZ0dmSXVnZXZBMXJfT0wzU2U2T3dEN1VPUW5VNGt4dlNoUEVxSE96ZUU0NmVGVzVEXy16RWkwVjBNNzhYdzJzNTlyNGFPei1OcVFkbFJkWXlmYW8zeFNlTGJ1b0N4dGV6VTVIWkIySnplampxZExuRC1SeGdndkRjNC1xX0NQcjFZYkxGdFVpWlNYY3V4dTMwalNSZnZzbWlkd2NqN3ktREFWWFVWQUM3eXZBZl9WREVfS2JVaXJPYjZVd041clBZeko4ZDNYcEE1eG1oNzFHbGdJUGtuYTd4YWpDc29KeGpYYzY4V2J0YXhOMjltSkRjWWNOSTFFS0hqdXczWUsyd01mREgzSmRnLVFxMlpBMDAyTlhsN1BhV3ZHdEZkZFNIY2gyaF9xTHpMbGxJYmg3dy12d1ZJckF0VElkdS1NN2dkTzZzZEFQNmtfYS1td2ZmRGg2c3BuUkRxZWlpbldnaWRfZ1pPR29QaU56Skl4TkpKa3dVNmdGcW1uRjVtbjV2ckh1UkR0eXFSaU1YM3JPTEN1NmFfQ3EyMUUyUmNHVzIxNm9HWWRBNWNKUE96SVNCaTVCWWhDNWRDOXFCVDc2VzFqV2REWGs4eEhZc2lzVlRPVU5IVDJELU9qeXRvZHBSQk80d2JEMV9CYjAzRWxhRnBkek5lUWF0dHBJU2xqalUyZ0czZFBNdjZkcEtXUjNKTkE0VHFrcWlESUtzVDFxc3hpQ1JGTXBWajRmN2Y5U2hnRmZGT1Z6UHgtRkh2eklVaWRtLUdYeEo1WGxTeThOZnhzblI5eGdTMjYxN1prc0I0Mk1PdHAwQS1ZSmxWRUxkQVVjcVlzcEJwRExvbVdHenlWakNEVUtxV055aUJuSlA5QzNBZXp3ZmhNUWVRbDd1YjBWRFh1NVI4TWlnaVF1SlZOSjdpamo3YTd2dHQ5RU5SYmdIcW5XUUUzcnptak1kQ2VqTVdONlhWcHNGcXlEXzlkWHJ1dkRrTzc4Nm1CRmpvNkRrUEthRHllZkx5bHlRY1lsVTBoeUkySElSS1JnVkRCbmJOaWdrLXYxazlBOVE1bGFjRlZOelZDQkJfUTJTbWQ4SW5OQmsyazN5WDc2NzVRZTRvWlJyZFprSnVRLWFrQ2c1OC1lMFZLZlVveFlnXzlFd0FxNVlEeEtFaUxnS3RTNTkwUGxzVkFxYVdxbXFIcHBFMThIOEtlQzhKcnU5d3lSamtFTkJxc0RCb1U2Mm04dm9Xc2wxUGhXYlFjOERJWElzTzM4aDIzRUFvQ2dDVnlyVFBLQ0NNcnczZ0dLQmExbU1wTHd4aWpKOXplM3BTTnJCRDRIRlZlQ3Nxcnc1ZTNXTUstMEJ0dEV5Q0FnZFU1RFRPYlJ4bEdZdnhNUUMyNFA4SG9iUlZhMi1FbS1RbFlVWGducW1aSE9Vc0dRdUJkR19XUkl3TTBWOG9SVEd6WGRSUUpSVThQaFVOMWFHVERZd01Ra2dQWTFCNlhxMjJoQmRtM2M4ZWtOT1hyTTNXUk5aV3VMNDl0V3JLUW9CdXFud2FpTXZJb2ZXdktiQVMwREVxZTdZbDA5Qms5OGllMmZCV25HdmYtdnlPaFVScnZRWkdGaTNsa2o2SmM3NmtDR1c2bFZpRS1pOUs1ZERqbUNtSVpCNUVKWmM1ZUVDMS1BazRkSXV2V2luVUVYdWpEaFVINi1KcUJUeFM2RlRBUlFFTWNHMFpTMFI0blZ2dFlINzJJSTdLOE1zLUZBVzhsLTA5ajdzX3VjRVY5NlkwQmo5SWF3WGljeDFGTEUyOHBtWk5KT1U0MGNoYklNZWg5UDY1Ymt6c2x5dXBHSFdYLVVBREpRb2sxV1RVaFFqTkNXV2hVVnNzYWlwazgtcWpyUGQzc01QRmd1MWhjelEySk9rNzlRTHlDcU0ySG8tcXpkTTQ2WmtoZzRuMlBLSzBLS0RmS2RqTXU5RmdZN003aHBVU3hBZS0yZl9Wb2tnaTRXNTZzSk5ONHdkYUdtT3ZHY2EyOS1Hckd3U2ZrRGxySU5UMEtGQm1NTHYxcmZTNHduc2hwVk1TcFozdFE2N1ZtOGlfWFJrWFZxVzA3Uks1dEgyVy00SnBTZEJjZjNfOGhRMTAzRV8tcDNqbUlqdkRmdDlJQkNrTkQxZWh4al9DaGYzM1FxdEdwMVMyVVpEa0ZBTFJOMEp5QkRQb0hUVzc4NlNuQzN2Tjh5eVNLcWx3UHRKZjdVWnEzWGk2VjZKQ1hoN1ZuS0V3TTNKTUlxaHJqWndXVkc3YUNSMThYUGx1bElJR1JlcVRyMlRLVU1CdmFXT1UtNWo3MmhEdm1vV3hXb3l6bkkyX3dRNEJBemlpWkducjdQLTdDcEw1SGdCdlJxUVZMc005TEtkSm11cGxxeDJERXlTTWVaUElrbkF5cFBlQUQ0OUtySEVWeTFLdkJfQmFxamRyV19ieGUtWU5jSDJ0OUNOdDBQVG9tcm4wSzdEcFp1SUhXMl9XQXRGNFRIS0xnT2ViY0lDNVNKeW9hNV9hM3JGZ0RtQUpXRlUxRG1JaFhwemtZbEdpdjQtdHRRRTJhRmJsV3pwbTBraHZfLV9BMFUwNjcyNUZaVGl6Unl2am1FWDcyNU4zMWRTeTZlTWdMNFk1ZmdIam5ZRWZNdnJMZmJ2XzZ4ZUtJelV6YjJJUUZxa09PVlpVUnVLOUc4YThuMjZrd1p2emN1OVZIVURVSlhzUUVlTzc4eWVOWk9fVUxKTUUzLVpSZVRBcDdEYlV3MjFkS3p2ekVxOF9PVDE2akt4Tk1YanM1OXhBQVpTdW9rbU5QUWRnNE5iWXByZVBKNFl0VndFdS00YU12RjJWVGh4OE9EcnZNclFaQzBTbTFWckVTckhPRXo1RXN1VU51ZXV3LVZ1QlB5VHlBZk9lNHdYWHp5NE9Od2gwZkpTakpXTTVpNnFBNXFzSHZYOENvdV9kOVRVRmNtSG53SndtUnlNODFhUEZBRHFFeFgyeGNtM0pzdGNXV2JMcDhzUEFTbU5MQ29ZOHZULVhBVTFJNEtMbEFncWRCWUl0Ny1NMWpKT1dXOS1DQXBWZ3B1c3BHaEtEWm9TZVF1N0F3NGZSOVA5al81R3p4dGZnRjRrY3dNR25xNlhuYlFLMkVWRk9jVXYyU1lDeWFhTjFnV1ZUQUhtN005Zk0tYWVPXzREbHlHbUIxc2YzT3BVVC0wVjN0SzQ2Y0FhSlFnY1QyOVd0QzJBQzZpdUs5SktOY3JCakVnYXJHeEtOV2tGUVFnWkNDSkdic252NHVTZ1ZCRW1KYW12X01ZU2lNSXE5czFZMGpaZjFXTEtTUFpYdDBaS1RuakNpNlhFdV9icmN4M1hYYkJYOE5nOGo4UjFYSWZPQWxOdUp1aXJxNUtIVnlXWEppejJsVEVKRklxNldxNWZGb0c1OEJnbXN4eFN2Mk5GS3Z3SUpFQTgweEJqMWRDdDZSS3dXOHdOZ205ekxUbGZ5NWpoYlp2LUF6X3dIaGtrWTJaZTJhYndlNERSQWhaMG5ENUhUb2FrZGRIc0hnR2hFQ3BUdDBQU2NUMS1nVHcyTWFCbWNjamNvX2F0SjZPMExQcDdJNjUzUlg3aWREV0tUVVFyN1cxTUlTWXdNVldlRmNQSjNrbkFRN2oyem5aaGE0YjhtSnpHMWJPY3dmakxNUlcyeHNrX0dXT1htZ0V1TGg4UTlQaGVCVmt4Tm5KZlFTNm5PS2hOWUw2WGNaMjhOYWVlRGdaYzFXc2tRZVhhTjM1OVpGc2ZPZ0lTM09hbTlDdTBpM2lSRzVUUUozc0doalRvOXdkcTN1dUlaX0VlZTBFMTZlVVBDdnVjZlgzR3ZrWDZHR3VvanpJclhXM1FBVEdpZjNGQkIwZUFXLWlJWFhrdWp5MWZJQT0=)
        CM_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmR5dFZNVHJDVFg4MTBuRGRkeUNYRXRHSVliUHh4alVwQlNld2F1bWUyVnV6UHBWeF85R0dQSzVwdlZ1TUluOVJQN0J0dW0wMWd4WUpSMzRxSXE4c1hUVXNVeGc9PQ==)
        CM_KEY_PASSWORD: Encrypted(Z0FBQUFBQmR5dFZNYXJZTEpsTHBSLWhCZTRoUXprY1lPWGpzMy1wMEpUaDRpMkJnU1BFNTJnT2JKaHhGOEhhbWtEa2F1VU5IbFBNRHZpX3pmZjZTYTNQTjVOMDBhZUpnYlE9PQ==)
        CM_KEY_ALIAS: Encrypted(Z0FBQUFBQmR5dFZNc2pOd3gwdUNsanpCRXJhNWdqbl9RV2xTR3hmNWhkZXRuUFNBS2dmXzlCM0dCMG0ybC1jcy1jeVk1NDBuZWhXaUFBUHZDc3lOTlhqWHlFSEpXd2hESHc9PQ==)
    triggering:
      events:
        - push
    scripts:
      - |
        rm -rf ~/codemagic-build-scripts
        git clone https://github.com/NevercodeHQ/codemagic-build-scripts.git ~/codemagic-build-scripts/ --depth 1
      - echo $CM_KEYSTORE | base64 --decode > acuity.jks
      - npm install
      - |
        cd android
        ./gradlew bundleRelease
      - |
        ~/codemagic-build-scripts/android/generate-universal-apks \
          --ks $FCI_BUILD_DIR/acuity.jks \
          --ks-pass $CM_KEYSTORE_PASSWORD \
          --ks-key-alias $CM_KEY_ALIAS \
          --key-pass $CM_KEY_PASSWORD \
          --pattern 'android/app/build/outputs/bundle/release/app.aab'
    artifacts:
      - android/app/build/**/outputs/**/*.apk
      - android/app/build/**/outputs/**/*.aab
      - android/app/build/**/outputs/**/mapping.txt
