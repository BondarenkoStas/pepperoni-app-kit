workflows:
  default-workflow:
    name: react native workflow
    environment:
      vars:
        CM_KEYSTORE: Encrypted(Z0FBQUFBQmQ0VXAzQWZQZ05YdDRWSFRwbkZhT3lpZjljWVNxcnlwaEF0Yk5DQzViOU4wNzUwaFk2ZUFlN0t1S08tSVZaMUsyRjh5b1hpMm9WbGl4Z0pGSFZ2Z21zMjF4a015cV9CSlp5TTVvbzllX1ZpQjNIWHFZWmU0Zmw3a3d1TDVPTnpQQW5tQU94Y2g5Q09Od2NHNEtha2RSYTN2aGF5VVBqQm5aM29XZzZtcG41ZmVQZV91Q3BxM2ZzZ2s1TmxtY0RPcDJVZGFyWVc5bGswV05EWngzdmhhNkZ6M3pmRWxFYWNuOTU3SWhPdS1IWUpwWEZWWXBCemljZ1cxWlhDbE5WY2FiODBMdTZUSWdRbzNmem9RWHdtajFfd1MyUno5U1BjcVU4UE5PbWEzVUU1eWRIelBXa0hwUmJYRHZWTUlUVkphWEJvcDFvUUtsUkFKb2RxbHR4NC02T1poWDdZUjJCajJIeXdBdktlVVN6VndxSmhCc1ZkUFIxLWprLWtPOVAxZmp5aUlTYVZWd0FaaVdBVU1jVnE5MXlEa0JGU2t4T2c0cDhnd09WbHhQbWkyY2dTM0FSelNERHY0UjlpNXhodlNES0hFcnlydmFTc1B3Um8tb0ljT1dKZGZDdW9PMllScG1iZGJ4eEY1YzN5Vmhxb1lQSGxsVmgwY19wamd2U2NoeTBNR0xsaUZVMlJhMzlPdVRzZ19oVnlqVENQNXpVUEpKSVlpVzBURUFQUl9UOWo5MDg4OHZpOWNZWGxZYkdpd1JFbXBjYV83eHdfZzF5clF1OWRPZXhmZ0ozdWFSTDZPUUg4X01uVUVOSUtSZ0JhNjVqOVNjTkVtUm04TENsbkFWLXdMUWlZNl9scWpNXzRnejV3cWphWm9lcFF6VkIwUHp5VmU4cUlvdS1hXzJOZzRtdTdtMlBxZ0o4d2pwU211Q0Jod0tjUkFidmpIemx5Y1BFYkphUXV2X0JpVTU5cjduYnNaNmhSeXFybkhSekxiSnk4RVZucHh5OGxON0NlU1UtQjAwQ29Sa0RqdmZFWE1kMko0SFNYZGVTcHF3YlhBbU9iaWc2d3JoVk1yMXdPcVRWMklNejRoM0N6UC1hY1V0VWNJdzRvaGhWWW1oS0RaaHlmZ1l0bk50OTFwQTlCcFRkeC1zTkQ5Rm5DWndNNWlpQkEzYUtKdkliaGpTUkV0TGtEMjRvbjh3UUR4c09rTVYxN09MYnZGS0pOTVEwd0NRQm13aXk4amJIMkJOQ3Z4T1c4ZDU3cWJ6eWRXSDdXWnVrZ2d4Ny1wbHN4S2JsZTNYX1RlZ2VnRkZubW5uVHgybWJxd01kbEFVbkljZE4wRDdWUXBwdURhSHhOc1dTT0RYbW00b1RVUWR6UEtsNGkyX1k4bGdDZy05Zk1mZ0YzQXBTRXFDQXQ3RUZSTTh5T0FzWV93ZHAtLThqaURQY1FwWlVKNG9vM19xV2FlaTFKdkc5Z1ZLeXJWVGUzMGNBQ25vYnBmeUppS3BFSWs1UXc3Nko5TFlyNUZkVWFILTNLenZGUnZSeVFsR1hfdVlKbFVtdEgwZ0JDOXBNN21kZXBocFdpOEQ2ZFlHa2sxYmlnd0ZzZUIwSHhVa1I2a1V1bVNOMTBhbjlWUmZGOE91YVlMUUlDS3NuMUF4LWotakVzM1FOOHVrQWNuZzBzcDAtay1ablE0SGIwWWUzZ2NLMFVpZUItczEwYzAwLUwwNXRSeHdUOUZnVjNrOThuMFVfVFNZbDdIZnZCSGw2ZjBwMkFEdE9qa0U4UGI3MEs5UWo1XzloeXEzdFBkNW43cGVVNXo4RExSUV96aW1LWFBNYzZvTmttQ05DbG1CTGtKdjRrYi1TVkFYNGUxS2wzX1czTVJ3b0pOY21vWWtfbGtKUGoyblotd25VbWxSVWU3MUxTMG9QQ1cwZXFtNVFsQjZEQTgxZy1LaGJfdDhGM3JiTGs2RHFCQjhzemFraThWbUZqY2tocDZaZlVxUm1BcW5iZ1REYmIwZ19hel9YZllKd2xLVWdjc09ydnRjUHBVUHNpUXlCS3BBNVZzb2c0YkdyMTNKbmVoV1RPazVEOTNCdVdXUktScFlZT29nb1A4VU1oWjFkOFpKRjR5d0Z4Y2Q0Ums2b0NNelRJaGthWHphNS02cEVkVUxGUVVmZjkyUzV6TDhHb3BwbjR2NkkzYWlVQ045Wmx5a2RZTGpfcXU5UjNYNkRwRHkzV3lQTEhtVTZOanl3R2hpTGVJcEhNZWV1UlQ4NnAzQmpUZG01V3lHSHo1ZXdyeUFZaWpZczdrb0NOVWlxSENaNERSXzl6NjVxTXNDUjZ3Zl85aWZ2YzRWQ3NuN0NZS19tTFI4WTU5akpoY0JVbnozQzFTNmdSOGhZNndUUF9SN0ZlZUo2Z3h0UkdPT2dIOWJPX1YwbUZndjBwc1NxbXpacFpYZ0ZEREd0elFiUkhueE83eHlRd1BUWnlKc2lrcnRPV083MnhKVkdLbGltT2N3eENnaWhUQ29fR3dON0puSDB2YWNrenllMWgtU1NHRTRoZzRvY0N0V0dad3FpeDIxMklFenNZVW5IMTFlMFZ3REo1UjhycVNkV2ZuUTRmblNtbGx4TWZYcXVDcDc4aFJJZ1B2QlJuQ29URkhSLVVGT3RnRUlhM0VqZF9nbnlZWVV2Vi14ekhLR290anM5WDFkeWQwTkRCZmtVSjNraDg3M0llMkdDRHZDVF9NVFhQOE1NcXpCTGhIOGNYR05WRmlVZEhYQU94M1pBSGtPQ0lXV2dod2hHOV9HTERNOHJtYlp1NUZsS3IyY1Vlcy1Td3BYTGlIQWNtdTRUVWFNODdzMmlITnpTOTJwQlZlRWk1MU5RMDZSX0dwdDFHQmJQSEItMjhlZDNGNmY5NEpzRG1fWkVic0lPOFpjUW0xdDVDZTYyOVlyaS1iYlRaX09ROERpZFI3WjhPczJmNWYwbXNPX016UHU2RG14Qk1RUnppTVZwNEx2WFJQc0E4ekFqQXNwTFREWGVuV0k1ZWRXaUxUVXVrTEJyV3VNem51M0J1T3VRM1hkYlo4NUdLc2VaQ2hKMGdzaVFoTXhvenllUC05WDBJOVMwV3FoTU8yTHFscTc4dDhxZmFwSkxpMHd1VXlVOGc2V2lxTTVPbzFvZ3hhSWQ5RHlfY2Faa084b3psbTVMVkdIaS13QU5MUFBWVWJlR0ljMmFRN0RNM1Z2YVJrMXNzSkozczduOWUtY2VOd2EzMDd5T3hSU0Z3VVNGTVdCc0ZlbG1sNFlrdEwyQTgtT3YwNTFzVFYzZGh0TENiWGhoelNKeGVHN21ZS1RQY1JWMlRwMW0yX3RtSnpHXzA3WHBvbmtLVnNXd0dyMFY3bklnQldzazNkRlRXeHB5Nld5czNYNllUaHl1UGUxYldKeTFnQjl4clgwLURINHpRc3p2Vk9XY3NycWJzZV9Wa0NRcEFoT0JaXzJ6Rml2Ym5LWF85UzZOby1Db25KR2QzTnZBb2xYdHVYMWotRDNINDFBRGpObC1BZ3lsbG96UHpsakxwQl84RHlJbzdOaVdxTS1NLXVZOW1QZU1XYTJRRUU1a2xaQkhOdFNaU0tya25yMm5QTUFCdHVHV19BVW52VGczTlB3T2F3QjJfbXFsQkJ5aUtjMEEtMG90Z3ZEU0ZjMnM3bVI4dlpXR1Q0UDJ0WW8tbVlJUVdUQkJpQ0k5cGh0eGZfUlZYV1ZfTUJzVTJrZ01iVi1kT2N5MzAwMFczdkNMaVlEWldudk5ZNDVRc2dhOXh3N2pUYkNjUEUwX3Nkdjg0N2JXRUNmaGFIOUFBTmM4MGFBNFZfSUFhMXpaTWhvdEJtNS1sMjhPOG10cTNwMFg3YnlyLWxSQnluOG5McWhNczJhbF80RkJoc0NmZWFJdzJwNmkwaFhOejhyanJiRWNNRkVRM01hNkNaOENpTUhDQ0szbkFxVTZEdVFtUjZERFlScWJCXzdtYmQwX2hjdThaaE5QOXpIN2pSUGNRMnVlaU4wRGRJRVNfYVd3cV91S193Ml9HbGc4VDA0VjBiZ3YtaWJURUw5SlY2YnpOSHF2SWthVTZEX0NkT1VLeGttaDFxeEwyOTZhRC1YWDZuLURLbE5UaTJFVzVwSHNWTzZYRHRIZ3FtVUFPNEpRVW12U3ZqMVQwRHVfUW5kTGJFZjJVRk1EQW53N1RWQks2TzJjNnJlT2dheF9PelA4azJDbmdZRmViblAwR25uUmIwUUJrdkVWQXRZaFppaHhKalQxYnViX09NeU5EaVd5UlhBMEhrUDlSXzBKeFc1QVRwZFM5d1Z5a1VURTBBUHQyak51NUk0eFlNblZrT3J4WkVFUkhoX3E5NTJGbjZBNWhlRlo0RG1UWE1aRGZNYmRIV3EtbFJSNTFDX1ZRWXpMTlRyUDlLMkNIXzB0dG4zQXNZMzk4akNha1dqWEVBRkdmakR1UmhkbFBaYW1nNGRWakNDNlY4TXF6MTFCNERUd0hzd3NvVjlZaGdpUXY0NmluZVU0YUIxbkhRRkpXTi1RZDUxNzJNNHlWcF9oVU1VVkVjQVBlVy12UFVuUk1zLS1WR0RYOWtXb2ROLTRyR0k4MlA0eVFaZGxFdnhpNGNFM2didlllU0s5QWUxQWVjTUd0NmFyclpZZEw1V1dYclZwTUxiX2FTcTB1NlpVdFkwMHppaWs2cVhPUFhQOGMwektJcHVBT1RkeVM4WU9fR0llWmF1NWd6SWFfM1JPSzdEUW01b05OZ01TSVFoUHNUeS02eGYya1k4eGF0QTVJTDk4MTF4eE1sbkd5THFvWXpnam92T0wwU2F3aXZybVlpU2l4UXhHWXRMSTI1eDFhWDg2WmFzOXZuM0JqN1haRkRaWDVrRHFQVVQ3dmhOTlpCTk1Lc1dNMk84eHNSVjU3MUpBSVd4bmlNZ21DcVJSSWxsbE1qQWQwazYyZ0lZdjlCNXBLbGVhUktQSERjblVzOEdiT1d6bm1MaHpFOTlINDFlUFktUk5uWlVlRGRyNlN5Um5LalpVeElMTXpKXy1qVmlrNlpjdzQ0dzY1cl9kVFlpanFNTjhKWnJaOU1KUzBNS3ZNdWV5TVlWQnBjazBUc0g2dzl4Ymp1eEhMUmhlSzhfUGEydEtXNHp2TGNLRGhkMWlTNVM2dnhCMUxMZXZTZVNRSEpwdmxvTDVkcjNDekJIOWk4bHlPcnVKOXoxbEQ5NU03T1RBN29MTnRpSV9KcVBJN2pPOWFxSXV0MEwwOW9fcml5NmhmSFhrSXJTam1LSXdNSDlveWNVOTU1Umt2ZHhFeHJkODYtZ1R6U1ZuMEsxQ3VXeG15T3NOdFhnN0JyOU1Obm5hNEt2OHJoZGg4SEZqQUNRcmdUcHhpNVVSUnVfTi1nTGdzTGpOd29CVjlNSnpiT0lkUUdGa3prYlhKZz0=)
        CM_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmQ0VXAzRXFYaFJZX2xzNl9UdV9SaWJWdDlJWUNIRDFrcjktVHVhOWp0amkybWxtaGdIajZKOHlQOEZkaVNvNEktUmxEcG1qTW9CQ1JCeHpTRmlPd3F1c3lNMlE9PQ==)
        CM_KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmQ0VXAzdlNWM1lUWk9Uazg0UUhicndWM21pYjZpOWh5TzJ3bG5MMFhaaXRQazN4SDhtQmsxOEM2RTVQNGFzMHJ5Qk5xQUtOSW9ZbWRhSHpVdmp1YXg5czFLbFE9PQ==)
        CM_KEY_ALIAS_USERNAME: Encrypted(Z0FBQUFBQmQ0VXAzSU14OGJfRkdWZFRqVW9ZaHlSdVFWS2JhNnBNMVN6SG4zZkMtRHk1R3lPam1FU21ReUl0bF9uVy04a3MxS0lDTmtqZ1liVS1OTXdFbTN4dm1rMFhfMVE9PQ==)
    scripts:
      - |
        # fetch codemagic helper scripts
        rm -rf ~/codemagic-build-scripts
        git clone https://github.com/NevercodeHQ/codemagic-build-scripts.git ~/codemagic-build-scripts/ --depth 1
      - npm install
      - |
        # set up key.properties
        echo $CM_KEYSTORE | base64 --decode > /tmp/keystore.keystore
        cat >> "$FCI_BUILD_DIR/android/key.properties" <<'EOF'
        storePassword=$CM_KEYSTORE_PASSWORD
        keyPassword=$CM_KEY_ALIAS_PASSWORD
        keyAlias=$CM_KEY_ALIAS_USERNAME
        storeFile=/tmp/keystore.keystore
        EOF
      - |
        cd android
        ./gradlew bundleRelease
      - |
        # generate signed universal apk with user specified keys
        ~/codemagic-build-scripts/android/generate-universal-apks \
          --ks /tmp/keystore.keystore \
          --ks-pass $CM_KEYSTORE_PASSWORD \
          --ks-key-alias $CM_KEY_ALIAS_USERNAME \
          --key-pass $CM_KEY_ALIAS_PASSWORD \
          --pattern 'android/app/build/outputs/bundle/release/app.aab'
    artifacts:
      - android/app/build/**/outputs/**/*.apk
      - android/app/build/**/outputs/**/*.aab
      - android/app/build/**/outputs/**/mapping.txt
    publishing:
      email:
        recipients:
          - bondarenko.stanislav.96@gmail.com
